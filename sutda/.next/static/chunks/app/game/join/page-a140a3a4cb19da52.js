(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[121],{9417:function(e,r,t){Promise.resolve().then(t.bind(t,5761))},7648:function(e,r,t){"use strict";t.d(r,{default:function(){return i.a}});var a=t(2972),i=t.n(a)},5761:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return o}});var a=t(7437),i=t(2265),n=t(9376),l=t(7648),s=t(4381);function o(){let e=(0,n.useRouter)(),[r,t]=(0,i.useState)(""),[o,u]=(0,i.useState)(""),[d,c]=(0,i.useState)(!1),[f,m]=(0,i.useState)(null),g=async t=>{if(t.preventDefault(),!r.trim()){m("게임 ID를 입력해주세요.");return}if(!o.trim()){m("사용자 이름을 입력해주세요.");return}c(!0),m(null);try{let t="user_".concat(Math.random().toString(36).substring(2,9));await (0,s.nY)(r,t,o),e.push("/game/".concat(r,"?userId=").concat(t,"&username=").concat(o))}catch(e){console.error("게임 참가 오류:",e),m("게임에 참가하는 중 오류가 발생했습니다. 게임 ID를 확인하세요.")}finally{c(!1)}};return(0,a.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-800 text-white p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md bg-gray-700 rounded-lg shadow-lg p-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6 text-center",children:"게임 참가"}),f&&(0,a.jsx)("div",{className:"bg-red-500 text-white p-3 rounded-md mb-4",children:f}),(0,a.jsxs)("form",{onSubmit:g,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"gameId",className:"block text-sm font-medium mb-2",children:"게임 ID"}),(0,a.jsx)("input",{type:"text",id:"gameId",value:r,onChange:e=>t(e.target.value),className:"w-full px-3 py-2 bg-gray-800 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"참가할 게임 ID를 입력하세요",disabled:d})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium mb-2",children:"사용자 이름"}),(0,a.jsx)("input",{type:"text",id:"username",value:o,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 bg-gray-800 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"게임에서 사용할 이름을 입력하세요",disabled:d})]}),(0,a.jsx)("button",{type:"submit",className:"w-full py-3 font-medium rounded-md ".concat(d?"bg-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),disabled:d,children:d?"참가 중...":"게임 참가"})]}),(0,a.jsx)("div",{className:"mt-6 text-center",children:(0,a.jsx)(l.default,{href:"/",className:"text-blue-400 hover:text-blue-300 text-sm",children:"돌아가기"})})]})})}},4381:function(e,r,t){"use strict";t.d(r,{Cb:function(){return u},Op:function(){return d},bG:function(){return f},dz:function(){return n},ky:function(){return c},nY:function(){return l},t:function(){return s},u1:function(){return o}});var a=t(5526),i=t(7024);async function n(){let{data:e,error:r}=await a.O.from("games").insert({status:"waiting",betting_value:0,current_turn:null}).select("id").single();if(r)throw console.error("게임 생성 오류:",r),r;return e.id}async function l(e,r,t){let{data:i}=await a.O.from("players").select("id").eq("game_id",e).eq("user_id",r).single();if(i){console.log("이미 게임에 참가 중입니다.");return}let{error:n}=await a.O.from("players").insert({game_id:e,user_id:r,username:t,cards:[],is_die:!1,balance:1e4});if(n)throw console.error("게임 참가 오류:",n),n;await a.O.from("game_actions").insert({game_id:e,player_id:r,action_type:"join",amount:0})}async function s(e){let{data:r,error:t}=await a.O.from("players").select("id, user_id").eq("game_id",e);if(t||!r||r.length<2)throw console.error("게임 시작 오류: 참가자가 부족합니다."),Error("게임을 시작하려면 최소 2명의 플레이어가 필요합니다.");let n=(0,i._7)();for(let e of r.map((e,r)=>{let t=[n[2*r],n[2*r+1]];return{id:e.id,cards:t}}))await a.O.from("players").update({cards:e.cards}).eq("id",e.id);await a.O.from("games").update({status:"playing",current_turn:r[0].user_id,betting_value:0}).eq("id",e)}async function o(e,r,t){let{data:n,error:l}=await a.O.from("games").select("current_turn, betting_value").eq("id",e).single();if(l||!n)throw console.error("베팅 오류: 게임을 찾을 수 없습니다."),Error("게임을 찾을 수 없습니다.");if(n.current_turn!==r)throw Error("당신의 차례가 아닙니다.");let{data:s,error:o}=await a.O.from("players").select("balance, is_die").eq("game_id",e).eq("user_id",r).single();if(o||!s)throw console.error("베팅 오류: 플레이어를 찾을 수 없습니다."),Error("플레이어를 찾을 수 없습니다.");if(s.is_die)throw Error("이미 다이 상태입니다.");if(s.balance<t)throw Error("잔액이 부족합니다.");await a.O.from("players").update({balance:s.balance-t}).eq("game_id",e).eq("user_id",r),await a.O.from("game_actions").insert({game_id:e,player_id:r,action_type:"bet",amount:t});let u=n.betting_value+t,{data:d,error:c}=await a.O.from("players").select("user_id, is_die").eq("game_id",e);if(c||!d)throw console.error("베팅 오류: 플레이어 목록을 가져올 수 없습니다."),Error("플레이어 목록을 가져올 수 없습니다.");let f=(0,i.el)(r,d.map(e=>({id:e.user_id,isDie:e.is_die})));await a.O.from("games").update({betting_value:u,current_turn:f}).eq("id",e)}async function u(e,r){let{data:t,error:n}=await a.O.from("games").select("current_turn, betting_value").eq("id",e).single();if(n||!t)throw console.error("콜 오류: 게임을 찾을 수 없습니다."),Error("게임을 찾을 수 없습니다.");if(t.current_turn!==r)throw Error("당신의 차례가 아닙니다.");let{data:l,error:s}=await a.O.from("game_actions").select("amount").eq("game_id",e).eq("action_type","bet").order("created_at",{ascending:!1}).limit(1).single();if(s||!l)throw console.error("콜 오류: 마지막 베팅 정보를 찾을 수 없습니다."),Error("마지막 베팅 정보를 찾을 수 없습니다.");let o=l.amount,{data:u,error:d}=await a.O.from("players").select("balance, is_die").eq("game_id",e).eq("user_id",r).single();if(d||!u)throw console.error("콜 오류: 플레이어를 찾을 수 없습니다."),Error("플레이어를 찾을 수 없습니다.");if(u.is_die)throw Error("이미 다이 상태입니다.");if(u.balance<o)throw Error("잔액이 부족합니다.");await a.O.from("players").update({balance:u.balance-o}).eq("game_id",e).eq("user_id",r),await a.O.from("game_actions").insert({game_id:e,player_id:r,action_type:"call",amount:o});let c=t.betting_value+o,{data:f,error:m}=await a.O.from("players").select("user_id, is_die, cards").eq("game_id",e);if(m||!f)throw console.error("콜 오류: 플레이어 목록을 가져올 수 없습니다."),Error("플레이어 목록을 가져올 수 없습니다.");let{data:g,error:_}=await a.O.from("game_actions").select("player_id").eq("game_id",e).eq("action_type","call").order("created_at",{ascending:!1});if(_)throw console.error("콜 오류: 콜 횟수를 확인할 수 없습니다."),Error("콜 횟수를 확인할 수 없습니다.");let h=f.filter(e=>!e.is_die);if(g&&g.length>=h.length-1){let r=(0,i.M2)(f.map(e=>({id:e.user_id,cards:e.cards,isDie:e.is_die})));if(r){let{data:t,error:i}=await a.O.from("players").select("balance").eq("game_id",e).eq("user_id",r).single();!i&&t&&await a.O.from("players").update({balance:t.balance+c}).eq("game_id",e).eq("user_id",r),await a.O.from("games").update({status:"finished",winner:r,betting_value:0}).eq("id",e)}}else{let t=(0,i.el)(r,f.map(e=>({id:e.user_id,isDie:e.is_die})));await a.O.from("games").update({betting_value:c,current_turn:t}).eq("id",e)}}async function d(e,r){let{data:t,error:n}=await a.O.from("games").select("current_turn, status").eq("id",e).single();if(n||!t)throw console.error("다이 오류: 게임을 찾을 수 없습니다."),Error("게임을 찾을 수 없습니다.");if(t.current_turn!==r)throw Error("당신의 차례가 아닙니다.");if("playing"!==t.status)throw Error("게임이 진행 중이 아닙니다.");await a.O.from("players").update({is_die:!0}).eq("game_id",e).eq("user_id",r),await a.O.from("game_actions").insert({game_id:e,player_id:r,action_type:"die",amount:0});let{data:l,error:s}=await a.O.from("players").select("user_id, is_die, cards").eq("game_id",e);if(s||!l)throw console.error("다이 오류: 플레이어 목록을 가져올 수 없습니다."),Error("플레이어 목록을 가져올 수 없습니다.");let o=l.filter(e=>!e.is_die);if(1===o.length){let r=o[0].user_id,{data:t,error:i}=await a.O.from("players").select("balance").eq("game_id",e).eq("user_id",r).single();if(!i&&t){let{data:i,error:n}=await a.O.from("games").select("betting_value").eq("id",e).single();!n&&i&&(await a.O.from("players").update({balance:t.balance+i.betting_value}).eq("game_id",e).eq("user_id",r),await a.O.from("games").update({status:"finished",winner:r,betting_value:0}).eq("id",e))}}else{let t=(0,i.el)(r,l.map(e=>({id:e.user_id,isDie:e.is_die})));await a.O.from("games").update({current_turn:t}).eq("id",e)}}async function c(e){let{data:r,error:t}=await a.O.from("games").select("*").eq("id",e).single();if(t||!r)throw console.error("게임 상태 조회 오류:",t),Error("게임을 찾을 수 없습니다.");let{data:i,error:n}=await a.O.from("players").select("*").eq("game_id",e);if(n)throw console.error("플레이어 정보 조회 오류:",n),Error("플레이어 정보를 가져올 수 없습니다.");return{id:r.id,status:r.status,currentTurn:r.current_turn,bettingValue:r.betting_value,winner:r.winner,players:i.map(e=>({id:e.user_id,username:e.username,cards:e.cards,isDie:e.is_die,balance:e.balance}))}}async function f(e,r,t,i){let{error:n}=await a.O.from("messages").insert({game_id:e,user_id:r,username:t,content:i});if(n)throw console.error("메시지 전송 오류:",n),n}},5526:function(e,r,t){"use strict";t.d(r,{O:function(){return a}});let a=(0,t(3777).eI)("https://ftzxcbarjntphlwmincc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ0enhjYmFyam50cGhsd21pbmNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIzNzk5OTAsImV4cCI6MjA1Nzk1NTk5MH0.h8y5X3kCGJgvVf-_EA4jOyjU-4Z5q24GHklQZgrocY4")},7024:function(e,r,t){"use strict";t.d(r,{M2:function(){return u},_7:function(){return l},el:function(){return o},g9:function(){return i},gr:function(){return n},z0:function(){return s}});let a=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20];function i(e){return Math.ceil(e/2)}function n(e){return 1===e||3===e||8===e}function l(){let e=[...a];for(let r=e.length-1;r>0;r--){let t=Math.floor(Math.random()*(r+1));[e[r],e[t]]=[e[t],e[r]]}return e}function s(e){if(2!==e.length)throw Error("카드는 정확히 2장이어야 합니다");let[r,t]=e,a=i(r),n=i(t);if(1===r&&3===t)return{cards:e,rank:"광땡",value:1e3};if(1===r&&8===t)return{cards:e,rank:"광땡",value:999};if(1===t&&3===r)return{cards:e,rank:"광땡",value:1e3};if(1===t&&8===r)return{cards:e,rank:"광땡",value:999};if(a===n)return{cards:e,rank:"땡",value:900+10*a};if(1===a&&2===n||2===a&&1===n)return{cards:e,rank:"알리",value:800};if(1===a&&4===n||4===a&&1===n)return{cards:e,rank:"독사",value:700};if(1===a&&9===n||9===a&&1===n)return{cards:e,rank:"구삥",value:600};if(1===a&&10===n||10===a&&1===n)return{cards:e,rank:"장삥",value:500};if(4===a&&10===n||10===a&&4===n)return{cards:e,rank:"장사",value:400};if(4===a&&6===n||6===a&&4===n)return{cards:e,rank:"세륙",value:300};let l=(a+n)%10;return 0===l?{cards:e,rank:"망통",value:0}:{cards:e,rank:"끗",value:l}}function o(e,r){let t=r.filter(e=>!e.isDie);if(t.length<=1){var a;return(null===(a=t[0])||void 0===a?void 0:a.id)||e}let i=(t.findIndex(r=>r.id===e)+1)%t.length;return t[i].id}function u(e){let r=e.filter(e=>!e.isDie);if(0===r.length)return null;if(1===r.length)return r[0].id;let t=r[0].id,a=r[0].cards;for(let e=1;e<r.length;e++)2===function(e,r){let t=s(e),a=s(r);return t.value>a.value?1:t.value<a.value?2:0}(a,r[e].cards)&&(t=r[e].id,a=r[e].cards);return t}}},function(e){e.O(0,[675,972,971,117,744],function(){return e(e.s=9417)}),_N_E=e.O()}]);