(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[121],{9417:function(r,e,t){Promise.resolve().then(t.bind(t,5761))},7648:function(r,e,t){"use strict";t.d(e,{default:function(){return o.a}});var a=t(2972),o=t.n(a)},5761:function(r,e,t){"use strict";t.r(e),t.d(e,{default:function(){return l}});var a=t(7437),o=t(2265),n=t(9376),i=t(7648),s=t(4381);function l(){let r=(0,n.useRouter)(),[e,t]=(0,o.useState)(""),[l,c]=(0,o.useState)(""),[u,d]=(0,o.useState)(!1),[f,m]=(0,o.useState)(null),g=async t=>{if(t.preventDefault(),!e.trim()){m("게임 ID를 입력해주세요.");return}if(!l.trim()){m("사용자 이름을 입력해주세요.");return}d(!0),m(null);try{let{playerId:t,gameState:a}=await (0,s.nY)(e,l);localStorage.setItem("game_".concat(e,"_player_id"),t),localStorage.setItem("game_".concat(e,"_username"),l),r.push("/game/".concat(e))}catch(r){console.error("게임 참가 오류:",r),m("게임에 참가하는 중 오류가 발생했습니다. 게임 ID를 확인하세요.")}finally{d(!1)}};return(0,a.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-800 text-white p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md bg-gray-700 rounded-lg shadow-lg p-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6 text-center",children:"게임 참가"}),f&&(0,a.jsx)("div",{className:"bg-red-500 text-white p-3 rounded-md mb-4",children:f}),(0,a.jsxs)("form",{onSubmit:g,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"gameId",className:"block text-sm font-medium mb-2",children:"게임 ID"}),(0,a.jsx)("input",{type:"text",id:"gameId",value:e,onChange:r=>t(r.target.value),className:"w-full px-3 py-2 bg-gray-800 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"참가할 게임 ID를 입력하세요",disabled:u})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium mb-2",children:"사용자 이름"}),(0,a.jsx)("input",{type:"text",id:"username",value:l,onChange:r=>c(r.target.value),className:"w-full px-3 py-2 bg-gray-800 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"게임에서 사용할 이름을 입력하세요",disabled:u})]}),(0,a.jsx)("button",{type:"submit",className:"w-full py-3 font-medium rounded-md ".concat(u?"bg-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),disabled:u,children:u?"참가 중...":"게임 참가"})]}),(0,a.jsx)("div",{className:"mt-6 text-center",children:(0,a.jsx)(i.default,{href:"/",className:"text-blue-400 hover:text-blue-300 text-sm",children:"돌아가기"})})]})})}},4381:function(r,e,t){"use strict";t.d(e,{Cb:function(){return u},Op:function(){return d},bG:function(){return f},dz:function(){return n},ky:function(){return s},nY:function(){return i},t:function(){return l},u1:function(){return c}});var a=t(5526),o=t(3837);async function n(r){let e=(0,o.Z)(),t=(0,o.Z)(),n="user_".concat(Math.random().toString(36).substring(2,9));try{let{data:o,error:i}=await a.O.from("games").insert({id:e,status:"waiting",current_turn:null,betting_value:0,winner:null}).select();if(i)throw console.error("게임 생성 오류 세부 정보:",i),Error("게임을 생성할 수 없습니다: "+i.message);console.log("게임 생성 성공:",e);let{data:s,error:l}=await a.O.from("players").insert({id:t,game_id:e,user_id:n,username:r,balance:1e4,is_die:!1}).select();if(l)throw console.error("플레이어 생성 오류 세부 정보:",l),Error("플레이어를 생성할 수 없습니다: "+l.message);return console.log("플레이어 생성 성공:",t),localStorage.setItem("game_".concat(e,"_user_id"),n),{gameId:e,playerId:t}}catch(r){throw console.error("게임 생성 중 예외 발생:",r),r}}async function i(r,e){try{let{data:t,error:n}=await a.O.from("games").select("*").eq("id",r).single();if(n||!t)throw console.error("게임 조회 오류 세부 정보:",n),Error("게임을 찾을 수 없습니다: "+((null==n?void 0:n.message)||"알 수 없는 오류"));if("waiting"!==t.status)throw Error("이미 시작된 게임에는 참가할 수 없습니다.");let i=(0,o.Z)(),l="user_".concat(Math.random().toString(36).substring(2,9)),{data:c,error:u}=await a.O.from("players").insert({id:i,game_id:r,user_id:l,username:e,balance:1e4,is_die:!1}).select();if(u)throw console.error("플레이어 생성 오류 세부 정보:",u),Error("게임에 참가할 수 없습니다: "+u.message);console.log("플레이어 참가 성공:",i),localStorage.setItem("game_".concat(r,"_user_id"),l);let d=await s(r);return{playerId:i,gameState:d}}catch(r){throw console.error("게임 참가 중 예외 발생:",r),r}}async function s(r){let{data:e,error:t}=await a.O.from("games").select("*").eq("id",r).single();if(t||!e)throw console.error("게임 조회 오류:",t),Error("게임을 찾을 수 없습니다.");let{data:o,error:n}=await a.O.from("players").select("*").eq("game_id",r);if(n)throw console.error("플레이어 조회 오류:",n),Error("플레이어 정보를 불러올 수 없습니다.");return{id:e.id,status:e.status,players:o.map(r=>({id:r.id,user_id:r.user_id,username:r.username,balance:r.balance,cards:r.cards||[],isDie:r.is_die})),currentTurn:e.current_turn||"",winner:e.winner,bettingValue:e.betting_value}}async function l(r){let{data:e,error:t}=await a.O.from("players").select("id").eq("game_id",r);if(t||!e||e.length<2)throw Error("최소 2명의 플레이어가 필요합니다.");let o=function(){let r=Array.from({length:40},(r,e)=>e+1);for(let e=r.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[r[e],r[t]]=[r[t],r[e]]}return r}();for(let r=0;r<e.length;r++){let t=[o.pop(),o.pop()].filter(Boolean),{error:n}=await a.O.from("players").update({cards:t}).eq("id",e[r].id);if(n)throw console.error("플레이어 카드 업데이트 오류:",n),Error("카드를 배분할 수 없습니다.")}let n=e[Math.floor(Math.random()*e.length)].id,{error:i}=await a.O.from("games").update({status:"playing",current_turn:n,betting_value:0}).eq("id",r);if(i)throw console.error("게임 상태 업데이트 오류:",i),Error("게임을 시작할 수 없습니다.");await m(r,"start",n)}async function c(r,e,t){if(t<=0)throw Error("베팅 금액은 0보다 커야 합니다.");let o=await s(r);if("playing"!==o.status)throw Error("게임이 진행 중이 아닙니다.");if(o.currentTurn!==e)throw Error("당신의 턴이 아닙니다.");let n=o.players.find(r=>r.id===e);if(!n)throw Error("플레이어를 찾을 수 없습니다.");if(n.balance<t)throw Error("잔액이 부족합니다.");let i=g(o.players,e),{error:l}=await a.O.from("games").update({current_turn:i,betting_value:o.bettingValue+t}).eq("id",r);if(l)throw console.error("게임 상태 업데이트 오류:",l),Error("베팅할 수 없습니다.");let{error:c}=await a.O.from("players").update({balance:n.balance-t}).eq("id",e);if(c)throw console.error("플레이어 잔액 업데이트 오류:",c),Error("잔액을 업데이트할 수 없습니다.");await m(r,"bet",e,t)}async function u(r,e){let t=await s(r);if("playing"!==t.status)throw Error("게임이 진행 중이 아닙니다.");if(t.currentTurn!==e)throw Error("당신의 턴이 아닙니다.");let o=t.players.find(r=>r.id===e);if(!o)throw Error("플레이어를 찾을 수 없습니다.");if(o.balance<500)throw Error("잔액이 부족합니다.");let n=g(t.players,e),{error:i}=await a.O.from("games").update({current_turn:n,betting_value:t.bettingValue+500}).eq("id",r);if(i)throw console.error("게임 상태 업데이트 오류:",i),Error("콜할 수 없습니다.");let{error:l}=await a.O.from("players").update({balance:o.balance-500}).eq("id",e);if(l)throw console.error("플레이어 잔액 업데이트 오류:",l),Error("잔액을 업데이트할 수 없습니다.");await m(r,"call",e,500)}async function d(r,e){let t=await s(r);if("playing"!==t.status)throw Error("게임이 진행 중이 아닙니다.");if(t.currentTurn!==e)throw Error("당신의 턴이 아닙니다.");let{error:o}=await a.O.from("players").update({is_die:!0}).eq("id",e);if(o)throw console.error("플레이어 다이 상태 업데이트 오류:",o),Error("다이할 수 없습니다.");let n=t.players.filter(r=>r.id!==e&&!r.isDie);if(1===n.length){let e=n[0].id,{error:o}=await a.O.from("players").update({balance:n[0].balance+t.bettingValue}).eq("id",e);if(o)throw console.error("승자 잔액 업데이트 오류:",o),Error("승자 잔액을 업데이트할 수 없습니다.");let{error:i}=await a.O.from("games").update({status:"finished",winner:e}).eq("id",r);if(i)throw console.error("게임 종료 상태 업데이트 오류:",i),Error("게임을 종료할 수 없습니다.")}else{let o=g(t.players,e),{error:n}=await a.O.from("games").update({current_turn:o}).eq("id",r);if(n)throw console.error("게임 상태 업데이트 오류:",n),Error("게임 상태를 업데이트할 수 없습니다.")}await m(r,"die",e)}async function f(r,e,t){if(!t.trim())throw Error("메시지 내용이 비어있습니다.");let{data:n,error:i}=await a.O.from("players").select("username, user_id").eq("id",e).single();if(i||!n)throw console.error("플레이어 정보 조회 오류:",i),Error("플레이어 정보를 찾을 수 없습니다.");let s=(0,o.Z)(),l=new Date().toISOString(),c={id:s,game_id:r,user_id:n.user_id,username:n.username,content:t,created_at:l},{error:u}=await a.O.from("messages").insert(c);if(u)throw console.error("메시지 저장 오류:",u),Error("메시지를 전송할 수 없습니다: "+u.message)}async function m(r,e,t,o){let{error:n}=await a.O.from("game_actions").insert({game_id:r,player_id:t,action_type:e,amount:o});n&&(console.error("게임 액션 기록 오류:",n),console.warn("게임 액션을 기록할 수 없습니다."))}function g(r,e){if(r.length<=1)return e;let t=r.filter(r=>!r.isDie),a=(t.findIndex(r=>r.id===e)+1)%t.length;return t[a].id}},5526:function(r,e,t){"use strict";t.d(e,{O:function(){return a}});let a=(0,t(3777).eI)("https://ftzxcbarjntphlwmincc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ0enhjYmFyam50cGhsd21pbmNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIzNzk5OTAsImV4cCI6MjA1Nzk1NTk5MH0.h8y5X3kCGJgvVf-_EA4jOyjU-4Z5q24GHklQZgrocY4",{realtime:{params:{eventsPerSecond:20}},auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!1},global:{fetch:fetch.bind(globalThis)}})}},function(r){r.O(0,[280,972,971,117,744],function(){return r(r.s=9417)}),_N_E=r.O()}]);