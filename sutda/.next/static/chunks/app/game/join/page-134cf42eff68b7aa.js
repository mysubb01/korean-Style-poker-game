(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[121],{9417:function(r,e,t){Promise.resolve().then(t.bind(t,5761))},7648:function(r,e,t){"use strict";t.d(e,{default:function(){return n.a}});var a=t(2972),n=t.n(a)},5761:function(r,e,t){"use strict";t.r(e),t.d(e,{default:function(){return s}});var a=t(7437),n=t(2265),o=t(9376),i=t(7648),l=t(4381);function s(){let r=(0,o.useRouter)(),[e,t]=(0,n.useState)(""),[s,u]=(0,n.useState)(""),[c,d]=(0,n.useState)(!1),[f,m]=(0,n.useState)(null),h=async t=>{if(t.preventDefault(),!e.trim()){m("게임 ID를 입력해주세요.");return}if(!s.trim()){m("사용자 이름을 입력해주세요.");return}d(!0),m(null);try{let{playerId:t,gameState:a}=await (0,l.nY)(e,s);localStorage.setItem("game_".concat(e,"_player_id"),t),localStorage.setItem("game_".concat(e,"_username"),s),r.push("/game/".concat(e))}catch(r){console.error("게임 참가 오류:",r),m("게임에 참가하는 중 오류가 발생했습니다. 게임 ID를 확인하세요.")}finally{d(!1)}};return(0,a.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-800 text-white p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md bg-gray-700 rounded-lg shadow-lg p-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6 text-center",children:"게임 참가"}),f&&(0,a.jsx)("div",{className:"bg-red-500 text-white p-3 rounded-md mb-4",children:f}),(0,a.jsxs)("form",{onSubmit:h,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"gameId",className:"block text-sm font-medium mb-2",children:"게임 ID"}),(0,a.jsx)("input",{type:"text",id:"gameId",value:e,onChange:r=>t(r.target.value),className:"w-full px-3 py-2 bg-gray-800 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"참가할 게임 ID를 입력하세요",disabled:c})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium mb-2",children:"사용자 이름"}),(0,a.jsx)("input",{type:"text",id:"username",value:s,onChange:r=>u(r.target.value),className:"w-full px-3 py-2 bg-gray-800 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"게임에서 사용할 이름을 입력하세요",disabled:c})]}),(0,a.jsx)("button",{type:"submit",className:"w-full py-3 font-medium rounded-md ".concat(c?"bg-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),disabled:c,children:c?"참가 중...":"게임 참가"})]}),(0,a.jsx)("div",{className:"mt-6 text-center",children:(0,a.jsx)(i.default,{href:"/",className:"text-blue-400 hover:text-blue-300 text-sm",children:"돌아가기"})})]})})}},4381:function(r,e,t){"use strict";t.d(e,{Cb:function(){return c},Op:function(){return d},bG:function(){return f},dz:function(){return o},ky:function(){return l},nY:function(){return i},t:function(){return s},u1:function(){return u}});var a=t(5526),n=t(3837);async function o(r){let e=(0,n.Z)(),t=(0,n.Z)(),{error:o}=await a.O.from("games").insert({id:e,status:"waiting",current_turn:null,betting_value:0,winner:null});if(o)throw console.error("게임 생성 오류:",o),Error("게임을 생성할 수 없습니다.");let{error:i}=await a.O.from("players").insert({id:t,game_id:e,username:r,balance:1e4,is_die:!1});if(i)throw console.error("플레이어 생성 오류:",i),Error("플레이어를 생성할 수 없습니다.");return{gameId:e,playerId:t}}async function i(r,e){let{data:t,error:o}=await a.O.from("games").select("*").eq("id",r).single();if(o||!t)throw console.error("게임 조회 오류:",o),Error("게임을 찾을 수 없습니다.");if("waiting"!==t.status)throw Error("이미 시작된 게임에는 참가할 수 없습니다.");let i=(0,n.Z)(),{error:s}=await a.O.from("players").insert({id:i,game_id:r,username:e,balance:1e4,is_die:!1});if(s)throw console.error("플레이어 생성 오류:",s),Error("게임에 참가할 수 없습니다.");return{playerId:i,gameState:await l(r)}}async function l(r){let{data:e,error:t}=await a.O.from("games").select("*").eq("id",r).single();if(t||!e)throw console.error("게임 조회 오류:",t),Error("게임을 찾을 수 없습니다.");let{data:n,error:o}=await a.O.from("players").select("*").eq("game_id",r);if(o)throw console.error("플레이어 조회 오류:",o),Error("플레이어 정보를 불러올 수 없습니다.");return{id:e.id,status:e.status,players:n.map(r=>({id:r.id,username:r.username,balance:r.balance,cards:r.cards||[],isDie:r.is_die})),currentTurn:e.current_turn||"",winner:e.winner,bettingValue:e.betting_value}}async function s(r){let{data:e,error:t}=await a.O.from("players").select("id").eq("game_id",r);if(t||!e||e.length<2)throw Error("최소 2명의 플레이어가 필요합니다.");let n=function(){let r=Array.from({length:40},(r,e)=>e+1);for(let e=r.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[r[e],r[t]]=[r[t],r[e]]}return r}();for(let r=0;r<e.length;r++){let t=[n.pop(),n.pop()].filter(Boolean),{error:o}=await a.O.from("players").update({cards:t}).eq("id",e[r].id);if(o)throw console.error("플레이어 카드 업데이트 오류:",o),Error("카드를 배분할 수 없습니다.")}let o=e[Math.floor(Math.random()*e.length)].id,{error:i}=await a.O.from("games").update({status:"playing",current_turn:o,betting_value:0}).eq("id",r);if(i)throw console.error("게임 상태 업데이트 오류:",i),Error("게임을 시작할 수 없습니다.");await m(r,"start",o)}async function u(r,e,t){if(t<=0)throw Error("베팅 금액은 0보다 커야 합니다.");let n=await l(r);if("playing"!==n.status)throw Error("게임이 진행 중이 아닙니다.");if(n.currentTurn!==e)throw Error("당신의 턴이 아닙니다.");let o=n.players.find(r=>r.id===e);if(!o)throw Error("플레이어를 찾을 수 없습니다.");if(o.balance<t)throw Error("잔액이 부족합니다.");let i=h(n.players,e),{error:s}=await a.O.from("games").update({current_turn:i,betting_value:n.bettingValue+t}).eq("id",r);if(s)throw console.error("게임 상태 업데이트 오류:",s),Error("베팅할 수 없습니다.");let{error:u}=await a.O.from("players").update({balance:o.balance-t}).eq("id",e);if(u)throw console.error("플레이어 잔액 업데이트 오류:",u),Error("잔액을 업데이트할 수 없습니다.");await m(r,"bet",e,t)}async function c(r,e){let t=await l(r);if("playing"!==t.status)throw Error("게임이 진행 중이 아닙니다.");if(t.currentTurn!==e)throw Error("당신의 턴이 아닙니다.");let n=t.players.find(r=>r.id===e);if(!n)throw Error("플레이어를 찾을 수 없습니다.");if(n.balance<500)throw Error("잔액이 부족합니다.");let o=h(t.players,e),{error:i}=await a.O.from("games").update({current_turn:o,betting_value:t.bettingValue+500}).eq("id",r);if(i)throw console.error("게임 상태 업데이트 오류:",i),Error("콜할 수 없습니다.");let{error:s}=await a.O.from("players").update({balance:n.balance-500}).eq("id",e);if(s)throw console.error("플레이어 잔액 업데이트 오류:",s),Error("잔액을 업데이트할 수 없습니다.");await m(r,"call",e,500)}async function d(r,e){let t=await l(r);if("playing"!==t.status)throw Error("게임이 진행 중이 아닙니다.");if(t.currentTurn!==e)throw Error("당신의 턴이 아닙니다.");let{error:n}=await a.O.from("players").update({is_die:!0}).eq("id",e);if(n)throw console.error("플레이어 다이 상태 업데이트 오류:",n),Error("다이할 수 없습니다.");let o=t.players.filter(r=>r.id!==e&&!r.isDie);if(1===o.length){let e=o[0].id,{error:n}=await a.O.from("players").update({balance:o[0].balance+t.bettingValue}).eq("id",e);if(n)throw console.error("승자 잔액 업데이트 오류:",n),Error("승자 잔액을 업데이트할 수 없습니다.");let{error:i}=await a.O.from("games").update({status:"finished",winner:e}).eq("id",r);if(i)throw console.error("게임 종료 상태 업데이트 오류:",i),Error("게임을 종료할 수 없습니다.")}else{let n=h(t.players,e),{error:o}=await a.O.from("games").update({current_turn:n}).eq("id",r);if(o)throw console.error("게임 상태 업데이트 오류:",o),Error("게임 상태를 업데이트할 수 없습니다.")}await m(r,"die",e)}async function f(r,e,t){if(!t.trim())throw Error("메시지 내용이 비어있습니다.");let{data:n,error:o}=await a.O.from("players").select("username").eq("id",e).single();if(o||!n)throw console.error("플레이어 정보 조회 오류:",o),Error("플레이어 정보를 찾을 수 없습니다.");let{error:i}=await a.O.from("messages").insert({game_id:r,player_id:e,username:n.username,content:t});if(i)throw console.error("메시지 저장 오류:",i),Error("메시지를 전송할 수 없습니다.")}async function m(r,e,t,n){let{error:o}=await a.O.from("game_actions").insert({game_id:r,player_id:t,action_type:e,amount:n});o&&(console.error("게임 액션 기록 오류:",o),console.warn("게임 액션을 기록할 수 없습니다."))}function h(r,e){if(r.length<=1)return e;let t=r.filter(r=>!r.isDie),a=(t.findIndex(r=>r.id===e)+1)%t.length;return t[a].id}},5526:function(r,e,t){"use strict";t.d(e,{O:function(){return a}});let a=(0,t(3777).eI)("https://ftzxcbarjntphlwmincc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ0enhjYmFyam50cGhsd21pbmNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIzNzk5OTAsImV4cCI6MjA1Nzk1NTk5MH0.h8y5X3kCGJgvVf-_EA4jOyjU-4Z5q24GHklQZgrocY4",{realtime:{params:{eventsPerSecond:10}}})}},function(r){r.O(0,[280,972,971,117,744],function(){return r(r.s=9417)}),_N_E=r.O()}]);