(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[184],{2183:function(e,t,a){Promise.resolve().then(a.bind(a,2462))},2462:function(e,t,a){"use strict";a.d(t,{default:function(){return _}});var l=a(7437),s=a(2265),r=a(9376),n=a(4381),i=a(3145),d=a(1994),o=a(3335);function c(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,o.m6)((0,d.W)(t))}function m(e){let{position:t,username:a,balance:s,isCurrentTurn:r,isDead:n,isMe:d,faceImage:o="/images/ui/face1.png",cards:m=[]}=e,u=function(e){switch(e%8){case 0:default:return{container:"bottom-4 left-1/2 -translate-x-1/2",cards:"mt-2"};case 1:return{container:"bottom-12 right-16 lg:right-24",cards:"mt-2"};case 2:return{container:"right-4 top-1/2 -translate-y-1/2",cards:"ml-2 flex-col space-y-1 space-x-0"};case 3:return{container:"top-12 right-16 lg:right-24",cards:"mb-2 flex-row-reverse"};case 4:return{container:"top-4 left-1/2 -translate-x-1/2",cards:"mb-2 flex-row-reverse"};case 5:return{container:"top-12 left-16 lg:left-24",cards:"mb-2 flex-row-reverse"};case 6:return{container:"left-4 top-1/2 -translate-y-1/2",cards:"mr-2 flex-col space-y-1 space-x-0"};case 7:return{container:"bottom-12 left-16 lg:left-24",cards:"mt-2"}}}(t),x=(e,t)=>{console.log("카드 상태:",e,"값:",t);try{if("open"===e&&t)return"/images/cards/".concat(t,".jpg");return"/images/cards/back.jpg"}catch(e){return console.error("카드 이미지 URL 생성 오류:",e),"/images/cards/back.jpg"}};return(0,l.jsxs)("div",{className:c("absolute flex flex-col items-center",u.container,r&&"animate-pulse"),children:[(0,l.jsxs)("div",{className:"relative mb-1",children:[(0,l.jsx)("div",{className:c("flex items-center justify-center relative",n&&"opacity-50"),children:(0,l.jsxs)("div",{className:c("relative w-16 h-16 rounded-full overflow-hidden border-2 shadow-lg",d?"border-blue-500":"border-yellow-500",r?"ring-2 ring-green-400":""),children:[(0,l.jsx)(i.default,{src:o,alt:a,width:64,height:64,className:"object-cover"}),n&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,l.jsx)(i.default,{src:"/images/ui/dieM.png",alt:"Die",width:40,height:40,className:"object-contain"})})]})}),(0,l.jsx)("div",{className:"absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-20 text-center",children:(0,l.jsxs)("div",{className:"bg-gray-900 bg-opacity-80 p-1 rounded-md shadow-md border border-yellow-600",children:[(0,l.jsx)("p",{className:"text-xs font-bold text-white truncate",children:a}),(0,l.jsxs)("p",{className:"text-xs text-yellow-400",children:[s.toLocaleString(),"P"]})]})})]}),(0,l.jsx)("div",{className:c("flex space-x-1",u.cards),children:m.map((e,t)=>(0,l.jsx)("div",{className:c("relative w-10 h-14 transition-all","hidden"===e.status&&"opacity-50 scale-95"),children:(0,l.jsx)(i.default,{src:x(e.status,e.value),alt:e.status,width:40,height:56,className:"rounded shadow-md"})},t))})]})}var u=a(7024),x=a(6414);function g(e){let{card:t,isHidden:a=!1,width:r=120,height:n=192}=e,[d,o]=(0,s.useState)(!1);if(a)return(0,l.jsx)("div",{className:"relative w-full h-full",style:{aspectRatio:"5/8"},children:(0,l.jsx)(i.default,{src:"/images/cards/back.png",alt:"카드 뒷면",width:r,height:n,className:"object-contain w-full h-full rounded-md shadow-md",priority:!0})});let c=(0,u.g9)(t),m=(0,u.gr)(t),x="/images/cards/".concat(c,"_").concat(m?"kwang":"yeol",".png");return(0,l.jsxs)("div",{className:"relative w-full h-full",style:{aspectRatio:"5/8"},children:[(0,l.jsx)(i.default,{src:d?"/images/cards/unknown.png":x,alt:"".concat(c,"월 ").concat(m?"광":"열끗"),width:r,height:n,className:"object-contain w-full h-full rounded-md shadow-md",priority:!0,onError:()=>o(!0)}),(0,l.jsxs)("div",{className:"absolute top-1 left-1 text-xs font-bold bg-white/70 dark:bg-black/70 px-1 rounded",children:[c,"월",m?" 광":""]})]})}let h={"38광땡":"최고의 패 - 3월 광과 8월 광","13광땡":"두 번째로 높은 광땡 - 1월 광과 3월 광","18광땡":"세 번째로 높은 광땡 - 1월 광과 8월 광",장땡:"가장 높은 땡 - 10월 카드 두 장","9땡":"9월 카드 두 장","8땡":"8월 카드 두 장","7땡":"7월 카드 두 장","6땡":"6월 카드 두 장","5땡":"5월 카드 두 장","4땡":"4월 카드 두 장","3땡":"3월 카드 두 장","2땡":"2월 카드 두 장","1땡":"1월 카드 두 장",알리:"1월과 2월 조합",독사:"1월과 4월 조합",구삥:"1월과 9월 조합",장삥:"1월과 10월 조합",장사:"4월과 10월 조합",세륙:"4월과 6월 조합",땡잡이:"3월과 7월 조합으로 9땡까지 이김",암행어사:"4월과 7월 조합으로 13광땡, 18광땡을 이김",구사:"4월과 9월 조합, 특수한 규칙 적용",망통:"끗수가 0인 조합","망통(2-8)":"2월과 8월 조합으로 가장 낮은 패"};function b(e){if(e.includes("끗")){let t=parseInt(e.replace("끗",""));return"".concat(t,"끗 - 두 카드의 끗수 합이 ").concat(t)}return h[e]||"알 수 없는 패"}function f(e){let{winner:t,players:a,restartGame:r}=e,[n,i]=(0,s.useState)(!1),[d,o]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{i(!0);let e=setTimeout(()=>{o(!0)},3e3);return()=>clearTimeout(e)},[]),!t||!t.cards||2!==t.cards.length)return null;let c=t.cards,m=(0,u.z0)(c),h=a.filter(e=>e.cards&&2===e.cards.length&&!e.isDie).map(e=>{let t=e.cards||[];return{...e,evaluation:2===t.length?(0,u.z0)(t):{rank:"없음",value:0}}}).sort((e,a)=>e.id===t.id?-1:a.id===t.id?1:a.evaluation.value-e.evaluation.value);return(0,l.jsx)(x.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:n?1:0,scale:n?1:.8},transition:{duration:.3},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:(0,l.jsxs)("div",{className:"w-full max-w-3xl rounded-lg bg-white p-6 shadow-xl dark:bg-zinc-900",children:[(0,l.jsx)("h2",{className:"mb-4 text-center text-2xl font-bold text-red-500",children:"게임 종료"}),(0,l.jsxs)("div",{className:"mb-6 text-center",children:[(0,l.jsxs)("p",{className:"text-xl font-semibold",children:["승자: ",t.username]}),(0,l.jsxs)("p",{className:"mt-2 text-lg font-medium text-amber-500",children:[m.rank," 패로 승리!"]}),(0,l.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:b(m.rank)})]}),(0,l.jsx)("div",{className:"mb-6 flex justify-center space-x-4",children:c.map((e,t)=>(0,l.jsxs)("div",{className:"w-20",children:[(0,l.jsx)(g,{card:e,isHidden:!1}),(0,l.jsx)("p",{className:"mt-1 text-center text-xs text-gray-500",children:function(e){let t=(0,u.g9)(e),a=(0,u.gr)(e)?"광":"일반";return"".concat(t,"월 ").concat(a)}(e)})]},t))}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h3",{className:"mb-2 text-center font-semibold text-gray-700 dark:text-gray-300",children:"모든 플레이어 결과"}),(0,l.jsx)("div",{className:"overflow-hidden rounded-md border dark:border-gray-700",children:(0,l.jsxs)("table",{className:"w-full text-left",children:[(0,l.jsx)("thead",{className:"bg-gray-50 text-gray-700 dark:bg-zinc-800 dark:text-gray-300",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-4 py-2",children:"플레이어"}),(0,l.jsx)("th",{className:"px-4 py-2",children:"패"}),(0,l.jsx)("th",{className:"px-4 py-2",children:"족보"}),d&&(0,l.jsx)("th",{className:"px-4 py-2",children:"카드"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-zinc-900",children:h.map(e=>(0,l.jsxs)("tr",{className:e.id===t.id?"bg-amber-50 dark:bg-amber-900/20":"",children:[(0,l.jsxs)("td",{className:"whitespace-nowrap px-4 py-2 text-sm font-medium",children:[e.username,e.id===t.id&&" (승자)"]}),(0,l.jsx)("td",{className:"whitespace-nowrap px-4 py-2 text-sm",children:(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("span",{children:e.evaluation.rank}),(0,l.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:b(e.evaluation.rank)})]})}),(0,l.jsx)("td",{className:"px-4 py-2 text-sm",children:e.id===t.id?(0,l.jsx)("span",{className:"rounded-full bg-green-100 px-2 py-1 text-xs font-semibold text-green-800 dark:bg-green-900/30 dark:text-green-400",children:"승리"}):(0,l.jsx)("span",{className:"rounded-full bg-red-100 px-2 py-1 text-xs font-semibold text-red-800 dark:bg-red-900/30 dark:text-red-400",children:"패배"})}),d&&(0,l.jsx)("td",{className:"px-4 py-2",children:(0,l.jsx)("div",{className:"flex space-x-1",children:e.cards&&e.cards.map((e,t)=>(0,l.jsx)("div",{className:"h-10 w-7",children:(0,l.jsx)(g,{card:e,isHidden:!1,width:28,height:40})},t))})})]},e.id))})]})}),!d&&(0,l.jsx)("p",{className:"mt-2 text-center text-xs text-gray-500",children:"잠시 후 모든 플레이어의 카드가 공개됩니다..."})]}),(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsx)("button",{onClick:r,className:"rounded-md bg-red-500 px-4 py-2 text-white hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700",children:"다시 게임하기"})})]})})}var p=a(9064);function y(e){var t;let{gameState:a,currentPlayerId:r,gameId:d,fetchGameState:o}=e,[u,x]=(0,s.useState)(!1),[g,h]=(0,s.useState)(!1),[b,y]=(0,s.useState)(null);(0,s.useEffect)(()=>{(null==a?void 0:a.status)!=="playing"||g?(null==a?void 0:a.status)!=="finished"||u||x(!0):h(!0)},[null==a?void 0:a.status,g,u]);let j=null==a?void 0:a.players.find(e=>e.id===r);if(!a||!j)return(0,l.jsx)("div",{className:"flex items-center justify-center h-full p-8",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"w-16 h-16 border-4 border-t-yellow-400 border-yellow-200 rounded-full animate-spin mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-yellow-400 font-bold",children:"게임 정보를 불러오는 중..."})]})});let w=a.players.length,v=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e&&0!==e.length?t?e.map(e=>({status:"open",value:function(e){console.log("카드 ID:",e);try{let t=e%10+1;return console.log("변환된 카드 ID:",t),String(t)}catch(e){return console.error("카드 파일명 변환 오류:",e),"1"}}(e)})):e.map(()=>({status:"showing"})):[{status:"hidden"},{status:"hidden"}]},N=a.players.map((e,t)=>{let l=(t-a.players.findIndex(e=>e.id===r))%w;l<0&&(l+=w);let s=e.id===r,n=e.id===a.currentTurn,i=s||u||"finished"===a.status;return{...e,position:l,isMe:s,isCurrentTurn:n,isDead:!0===e.isDie,cards:v(e.cards,i)}}),k="waiting"===a.status?Array.from({length:8-w},(e,t)=>(w+t)%8):[],S=async()=>{try{let e=null==a?void 0:a.players.find(e=>e.id===r);if(!e||e.balance<2e3){p.Am.error("잔액이 부족합니다. 최소 2000원 이상 필요합니다.");return}await (0,n.t)(d),p.Am.success("새 게임이 시작되었습니다."),o()}catch(e){console.error("게임 재시작 오류:",e),p.Am.error("게임을 재시작할 수 없습니다.")}};return(0,l.jsx)("div",{className:"h-full min-h-screen w-full bg-gradient-to-b from-green-800 to-green-950 p-4",children:(0,l.jsx)("div",{className:"mx-auto flex h-full max-w-7xl flex-col lg:flex-row",children:(0,l.jsxs)("div",{className:"relative mb-4 flex-1 overflow-hidden rounded-2xl bg-green-900 p-6 shadow-xl lg:mb-0 lg:mr-4",children:[(0,l.jsxs)("div",{className:"relative h-full w-full overflow-hidden",children:[(0,l.jsxs)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-b from-green-800 to-green-900 m-8",style:{boxShadow:"0 0 30px rgba(0, 0, 0, 0.7), inset 0 0 80px rgba(0, 0, 0, 0.3), 0 0 15px rgba(255, 215, 0, 0.3)",border:"10px solid #8B4513"},children:[(0,l.jsxs)("div",{className:"absolute inset-2 rounded-full bg-green-700 bg-opacity-50 flex items-center justify-center",children:[(0,l.jsx)("div",{className:"w-[80%] h-[80%] rounded-full border-2 border-dashed border-green-500 border-opacity-50"}),(0,l.jsx)(i.default,{src:"/images/table/bgM.png",alt:"Table Background",layout:"fill",objectFit:"cover",className:"rounded-full opacity-80"})]}),(0,l.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center",children:(0,l.jsx)("div",{className:"relative mb-3",children:(0,l.jsx)("div",{className:"px-4 py-2 bg-gray-900 bg-opacity-80 rounded-lg border border-yellow-600 shadow-lg",children:(0,l.jsxs)("p",{className:"text-yellow-400 font-bold text-center",children:["총 배팅 금액: ",a.bettingValue.toLocaleString()," 포인트"]})})})})]}),N.map(e=>(0,l.jsx)(m,{position:e.position,username:e.username,balance:e.balance,isCurrentTurn:e.isCurrentTurn,isDead:e.isDead,isMe:e.isMe,faceImage:"/images/ui/face".concat(parseInt(e.id)%5+1,".png"),cards:e.cards},e.id)),"waiting"===a.status&&k.map(e=>(0,l.jsx)("div",{className:c("absolute z-20",function(e){switch(e%8){case 0:default:return"bottom-6 left-1/2 -translate-x-1/2";case 1:return"bottom-16 right-20 lg:right-28";case 2:return"right-6 top-1/2 -translate-y-1/2";case 3:return"top-16 right-20 lg:right-28";case 4:return"top-6 left-1/2 -translate-x-1/2";case 5:return"top-16 left-20 lg:left-28";case 6:return"left-6 top-1/2 -translate-y-1/2";case 7:return"bottom-16 left-20 lg:left-28"}}(e)),children:(0,l.jsx)("button",{onClick:()=>y(e),className:"w-16 h-16 rounded-full flex items-center justify-center bg-gray-800 bg-opacity-60 hover:bg-opacity-80 border-2 border-dashed border-yellow-400 transition-all transform hover:scale-110",children:(0,l.jsx)("span",{className:"text-yellow-400 font-bold text-xs",children:"빈 자리"})})},"empty-".concat(e))),"waiting"===a.status&&(0,l.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center z-30",children:(0,l.jsxs)("div",{className:"px-6 py-4 bg-black bg-opacity-70 rounded-lg border border-yellow-600 shadow-lg",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-yellow-400 mb-2",children:"게임 대기 중"}),(0,l.jsxs)("p",{className:"text-white",children:["현재 ",w,"명의 플레이어가 참가했습니다."]}),(0,l.jsx)("p",{className:"text-white mt-1",children:"게임을 시작하려면 최소 2명의 플레이어가 필요합니다."})]})}),"finished"===a.status&&(0,l.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center z-30",children:(0,l.jsxs)("div",{className:"px-6 py-4 bg-black bg-opacity-70 rounded-lg border border-yellow-600 shadow-lg",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-yellow-400 mb-2",children:"게임 종료!"}),(0,l.jsxs)("p",{className:"text-white",children:["승자: ",(null===(t=a.players.find(e=>e.id===a.winner))||void 0===t?void 0:t.username)||"없음"]})]})})]}),(null==a?void 0:a.status)==="finished"&&a.winner&&(0,l.jsx)(f,{winner:a.players.find(e=>e.id===a.winner),players:a.players,restartGame:S})]})})})}var j=a(29),w=a.n(j);let v={call:"/images/ui/callbtn.png",die:"/images/ui/diebtn.png",bet:"/images/ui/doublebtn.png",half:"/images/ui/halfbtn.png",quarter:"/images/ui/quarterbtn.png"};function N(e){var t,a;let{gameState:r,currentPlayerId:d,onAction:o}=e,[c,m]=(0,s.useState)(500),[u,x]=(0,s.useState)(!1),[g,h]=(0,s.useState)(null),b=r.currentTurn===d,f="waiting"===r.status,p="playing"===r.status,y="finished"===r.status,j="regame"===r.status,N=r.players.find(e=>e.id===d),k=r.winner?null===(t=r.players.find(e=>e.id===r.winner))||void 0===t?void 0:t.username:null,S=async()=>{x(!0),h(null);try{await (0,n.t)(r.id),o()}catch(e){console.error("게임 시작 오류:",e),h("게임을 시작하는 중 오류가 발생했습니다.")}finally{x(!1)}},I=async e=>{x(!0),h(null);try{if(!N)throw Error("플레이어 정보를 찾을 수 없습니다.");let t=void 0!==e?e:c;if(t<=0||t>N.balance)throw Error("유효하지 않은 베팅 금액입니다.");await (0,n.u1)(r.id,d,"bet",t),o()}catch(e){console.error("베팅 오류:",e),h("베팅 중 오류가 발생했습니다.")}finally{x(!1)}},_=async()=>{x(!0),h(null);try{await (0,n.u1)(r.id,d,"call"),o()}catch(e){console.error("콜 오류:",e),h("콜 중 오류가 발생했습니다.")}finally{x(!1)}},C=async()=>{x(!0),h(null);try{await (0,n.u1)(r.id,d,"die"),o()}catch(e){console.error("다이 오류:",e),h("다이 중 오류가 발생했습니다.")}finally{x(!1)}},z=async()=>{x(!0),h(null);try{await (0,n.u1)(r.id,d,"half"),o()}catch(e){console.error("하프 오류:",e),h("하프 중 오류가 발생했습니다.")}finally{x(!1)}},A=async()=>{x(!0),h(null);try{await (0,n.u1)(r.id,d,"check"),o()}catch(e){console.error("체크 오류:",e),h("체크 중 오류가 발생했습니다.")}finally{x(!1)}},D=e=>{let{imageSrc:t,label:a,onClick:s,disabled:r=!1}=e;return(0,l.jsxs)("button",{className:"relative h-14 overflow-hidden rounded-md shadow-md ".concat(r?"opacity-50 cursor-not-allowed":"transform hover:scale-105 transition-transform"),onClick:s,disabled:r,children:[(0,l.jsx)(i.default,{src:t,alt:a,width:120,height:56,className:"w-full h-full object-cover"}),(0,l.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-white font-bold text-lg drop-shadow-lg",children:a})]})};if(y)return(0,l.jsxs)("div",{className:"p-6 bg-gray-900 bg-opacity-90 rounded-lg border border-yellow-500 shadow-lg",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-center mb-4 text-yellow-400",children:"게임 종료"}),k&&(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)("p",{className:"text-yellow-400 font-bold mb-2 text-xl",children:[k,"님이 승리했습니다!"]}),(0,l.jsxs)("p",{className:"text-gray-300",children:["획득 포인트: ",r.bettingValue]})]}),(0,l.jsx)("button",{className:"mt-4 w-full py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white font-bold rounded-md shadow-lg transition-all",onClick:()=>window.location.href="/",children:"홈으로 돌아가기"})]});if(j){let e=r.regame_remaining_time||5;return(0,l.jsxs)("div",{className:"jsx-5ed6bcbea3794aed p-6 bg-gray-900 bg-opacity-90 rounded-lg border border-yellow-500 shadow-lg",children:[(0,l.jsx)("h2",{className:"jsx-5ed6bcbea3794aed text-2xl font-bold text-center mb-4 text-yellow-400",children:"재경기 진행 중"}),(0,l.jsx)("div",{className:"jsx-5ed6bcbea3794aed flex justify-center",children:(0,l.jsx)("div",{className:"jsx-5ed6bcbea3794aed spinner"})}),(0,l.jsx)("p",{className:"jsx-5ed6bcbea3794aed text-gray-300 text-center mt-4",children:"특수 패(구사/멍텅구리구사) 발생으로 재경기를 준비하고 있습니다."}),(0,l.jsxs)("p",{className:"jsx-5ed6bcbea3794aed text-yellow-400 text-center mt-2 font-bold",children:[e,"초 후 재시작..."]}),(0,l.jsx)(w(),{id:"5ed6bcbea3794aed",children:".spinner.jsx-5ed6bcbea3794aed{border:4px solid rgba(0,0,0,.1);width:36px;height:36px;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;border-left-color:#fbbd23;-webkit-animation:spin 1s linear infinite;-moz-animation:spin 1s linear infinite;-o-animation:spin 1s linear infinite;animation:spin 1s linear infinite}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}"})]})}return f?(0,l.jsxs)("div",{className:"p-6 bg-gray-900 bg-opacity-90 rounded-lg border border-yellow-500 shadow-lg",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-center mb-4 text-yellow-400",children:"게임 대기 중"}),(0,l.jsxs)("p",{className:"text-gray-300 text-center mb-4",children:["현재 ",r.players.length,"명의 플레이어가 대기 중입니다."]}),g&&(0,l.jsx)("div",{className:"bg-red-500 text-white p-3 rounded-md mb-4",children:g}),(0,l.jsx)("div",{className:"text-center",children:(0,l.jsx)("button",{className:"py-3 px-6 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white font-bold rounded-md shadow-lg transition-all ".concat(u?"opacity-50 cursor-not-allowed":""),onClick:S,disabled:u||r.players.length<2,children:u?"처리 중...":"게임 시작"})}),r.players.length<2&&(0,l.jsx)("p",{className:"text-red-400 text-center mt-2",children:"최소 2명의 플레이어가 필요합니다."}),(0,l.jsxs)("div",{className:"mt-4 text-gray-300 text-center text-sm",children:[(0,l.jsxs)("p",{children:["게임 ID: ",r.id]}),(0,l.jsx)("p",{className:"mt-1",children:"이 ID를 친구들에게 공유하여 같이 게임하세요!"})]})]}):p?(0,l.jsxs)("div",{className:"p-4 bg-gray-900 bg-opacity-95 backdrop-blur-sm rounded-lg border border-yellow-500 shadow-xl",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,l.jsx)("h2",{className:"text-lg font-bold text-yellow-400",children:"게임 진행 중"}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsxs)("p",{className:"text-yellow-400 font-bold",children:[r.bettingValue," 포인트"]}),N&&(0,l.jsxs)("p",{className:"text-xs text-gray-300",children:["내 잔액: ",N.balance," P"]})]})]}),g&&(0,l.jsx)("div",{className:"bg-red-500 text-white p-2 rounded-md mb-2 text-xs",children:g}),b?(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-green-400 font-bold text-sm mb-2",children:"내 턴입니다!"}),(0,l.jsx)("div",{className:"mb-3",children:(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)("input",{type:"number",value:c,onChange:e=>m(parseInt(e.target.value)||0),min:100,max:(null==N?void 0:N.balance)||0,step:100,className:"flex-grow px-2 py-1 bg-gray-800 rounded-md border border-gray-600 focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm",disabled:u}),(0,l.jsx)("button",{className:"px-3 py-1 bg-yellow-600 hover:bg-yellow-500 text-white font-bold rounded-md shadow transition-all text-sm",onClick:()=>I(),disabled:u||!N||c<=0||c>N.balance,children:"베팅"})]})}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[!(r.bettingValue>0)&&(0,l.jsx)(D,{imageSrc:"/images/ui/checkbtn.png",label:"체크",onClick:A,disabled:u}),(0,l.jsx)(D,{imageSrc:v.call,label:"콜",onClick:_,disabled:u||!(r.bettingValue>0)}),(0,l.jsx)(D,{imageSrc:v.bet,label:"따당",onClick:()=>I(2*r.bettingValue),disabled:u||((null==N?void 0:N.balance)||0)<2*r.bettingValue}),(0,l.jsx)(D,{imageSrc:v.quarter,label:"쿼터",onClick:()=>I(Math.floor(r.bettingValue/4)),disabled:u||0>=Math.floor(r.bettingValue/4)||((null==N?void 0:N.balance)||0)<Math.floor(r.bettingValue/4)}),(0,l.jsx)(D,{imageSrc:v.half,label:"하프",onClick:()=>z(),disabled:u}),(0,l.jsx)(D,{imageSrc:v.die,label:"다이",onClick:C,disabled:u})]})]}):(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{className:"text-blue-400 mb-2 text-sm",children:[(0,l.jsx)("span",{className:"font-bold",children:(null===(a=r.players.find(e=>e.id===r.currentTurn))||void 0===a?void 0:a.username)||"알 수 없음"}),"님의 차례입니다"]}),(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsx)("div",{className:"w-1/2",children:(0,l.jsx)(D,{imageSrc:v.die,label:"다이 (포기)",onClick:C,disabled:u||(null==N?void 0:N.isDie)})})})]})]}):(0,l.jsx)("div",{className:"p-6 bg-gray-900 bg-opacity-90 rounded-lg border border-yellow-500 shadow-lg",children:(0,l.jsx)("p",{className:"text-gray-300 text-center",children:"게임 상태를 불러오는 중..."})})}function k(e){let{gameId:t,playerId:a,username:r,messages:d}=e,[o,c]=(0,s.useState)(""),[m,u]=(0,s.useState)(!1),[x,g]=(0,s.useState)(null),h=(0,s.useRef)(null);(0,s.useEffect)(()=>{h.current&&(h.current.scrollTop=h.current.scrollHeight)},[d]);let b=async e=>{if(e.preventDefault(),o.trim()){u(!0),g(null);try{await (0,n.bG)(t,a,o),c("")}catch(e){console.error("메시지 전송 오류:",e),g("메시지를 전송하는 중 오류가 발생했습니다.")}finally{u(!1)}}};return(0,l.jsxs)("div",{className:"flex flex-col h-full bg-gray-900 bg-opacity-80 rounded-lg border border-yellow-600 shadow-lg overflow-hidden",children:[(0,l.jsx)("div",{className:"p-2 bg-gradient-to-r from-yellow-700 to-yellow-900 border-b border-yellow-600",children:(0,l.jsx)("h2",{className:"text-sm font-bold text-yellow-300",children:"채팅"})}),(0,l.jsx)("div",{ref:h,className:"flex-grow p-2 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-800",style:{maxHeight:"calc(100% - 80px)"},children:0===d.length?(0,l.jsx)("p",{className:"text-gray-400 text-center italic text-xs",children:"메시지가 없습니다."}):(0,l.jsx)("div",{className:"space-y-1",children:d.map(e=>(0,l.jsxs)("div",{className:"".concat(e.user_id===localStorage.getItem("game_".concat(t,"_user_id"))?"bg-blue-900 ml-4 rounded-tl-md rounded-tr-md rounded-bl-md":"bg-gray-800 mr-4 rounded-tl-md rounded-tr-md rounded-br-md"," p-1 shadow-md text-xs"),children:[(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,l.jsx)("span",{className:"font-bold text-xs ".concat(e.user_id===localStorage.getItem("game_".concat(t,"_user_id"))?"text-blue-300":"text-yellow-300"),children:e.username}),(0,l.jsx)("span",{className:"text-gray-400 text-xs",children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,l.jsx)("p",{className:"text-white break-words",children:e.content})]},e.id))})}),x&&(0,l.jsx)("div",{className:"bg-red-600 text-white p-1 text-xs",children:x}),(0,l.jsx)("form",{onSubmit:b,className:"p-2 bg-gray-800 border-t border-gray-700",children:(0,l.jsxs)("div",{className:"flex space-x-1",children:[(0,l.jsx)("input",{type:"text",value:o,onChange:e=>c(e.target.value),className:"flex-grow px-2 py-1 bg-gray-700 text-white text-sm rounded-lg border border-gray-600 focus:outline-none focus:ring-1 focus:ring-yellow-500",placeholder:"메시지 입력...",disabled:m}),(0,l.jsx)("button",{type:"submit",disabled:m||!o.trim(),className:"px-2 bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-500 hover:to-yellow-600 text-white font-bold rounded-lg transition-all ".concat(m||!o.trim()?"opacity-50 cursor-not-allowed":""),children:(0,l.jsx)(i.default,{src:"/images/ui/send.png",alt:"전송",width:16,height:16,className:"w-4 h-4"})})]})})]})}var S=a(5526);function I(){return(0,l.jsxs)("div",{className:"flex h-full w-full flex-col items-center justify-center bg-green-900 p-8",children:[(0,l.jsx)("div",{className:"w-16 h-16 mb-4 rounded-full border-4 border-t-amber-400 border-amber-200 animate-spin"}),(0,l.jsxs)("div",{className:"space-y-2 text-center",children:[(0,l.jsx)("div",{className:"text-lg font-bold text-amber-400",children:"게임 정보 로드 중..."}),(0,l.jsx)("div",{className:"text-sm text-amber-300/70",children:"잠시만 기다려 주세요"})]}),(0,l.jsxs)("div",{className:"mt-8 w-full max-w-xl",children:[(0,l.jsx)("div",{className:"aspect-video rounded-xl bg-green-800/50 animate-pulse"}),(0,l.jsx)("div",{className:"mt-6 flex justify-center",children:(0,l.jsx)("div",{className:"h-12 w-48 rounded-md bg-gray-700/50 animate-pulse"})}),(0,l.jsx)("div",{className:"mt-8 grid grid-cols-2 sm:grid-cols-3 gap-4",children:[...Array(6)].map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-700/50 animate-pulse"}),(0,l.jsx)("div",{className:"h-6 w-24 rounded bg-gray-700/50 animate-pulse"})]},t))})]})]})}function _(e){let{gameId:t}=e;(0,r.useRouter)();let[a,i]=(0,s.useState)(null),[d,o]=(0,s.useState)(null),[c,m]=(0,s.useState)(""),[u,x]=(0,s.useState)(!1),[g,h]=(0,s.useState)(null),[b,f]=(0,s.useState)([]),[j,w]=(0,s.useState)(!1),[v,_]=(0,s.useState)(!1),C=async()=>{try{let{data:e,error:a}=await S.O.from("messages").select("*").eq("game_id",t).order("created_at",{ascending:!0});!a&&e?f(e):console.error("메시지 불러오기 오류:",a)}catch(e){console.error("메시지 불러오기 예외:",e)}},z=async()=>{try{let e=await (0,n.ky)(t);return console.log("게임 상태 업데이트:",e),i(e),e}catch(e){return console.error("게임 상태 불러오기 실패:",e),h("게임 정보를 불러오는 중 오류가 발생했습니다."),null}};(0,s.useEffect)(()=>{let e=localStorage.getItem("game_".concat(t,"_player_id")),a=localStorage.getItem("game_".concat(t,"_username"));if(e&&a){console.log("저장된 플레이어 정보 발견:",e,a),o(e),m(a),z(),C();let t=setInterval(()=>{console.log("게임 상태 폴링..."),z()},1e3),l=setInterval(()=>{console.log("메시지 폴링..."),C()},1e3);return()=>{clearInterval(t),clearInterval(l),console.log("폴링 인터벌 정리 완료")}}},[t]);let A=async e=>{if(!e.trim()){h("닉네임을 입력해주세요.");return}x(!0),h(null);try{let{playerId:a,gameState:l}=await (0,n.nY)(t,e);localStorage.setItem("game_".concat(t,"_player_id"),a),localStorage.setItem("game_".concat(t,"_username"),e),o(a),m(e),i(l),C()}catch(e){console.error("게임 참가 오류:",e),h("게임 참가 중 오류가 발생했습니다.")}finally{x(!1)}},D=()=>{z()};null==a||a.status;let E=(null==a?void 0:a.status)==="playing",T=(null==a?void 0:a.status)==="finished",F=(null==a?void 0:a.status)==="regame";null==a||a.players.find(e=>e.id===d);let V=(null==a?void 0:a.currentTurn)===d;return((0,s.useEffect)(()=>("true"!==sessionStorage.getItem("gameReconnected")&&(p.Am.success("게임에 접속되었습니다"),sessionStorage.setItem("gameReconnected","true"),v&&(0,p.Am)("기존 게임에 재접속했습니다",{duration:3e3})),()=>{sessionStorage.removeItem("gameReconnected")}),[v]),(0,s.useEffect)(()=>{if(E&&V){p.Am.success("당신의 턴입니다!",{duration:3e3});let e=new Audio("/sounds/turn.mp3");e.volume=.5,e.play().catch(e=>console.log("효과음 재생 실패:",e))}},[null==a?void 0:a.currentTurn,E,V]),(0,s.useEffect)(()=>{if(T&&(null==a?void 0:a.winner)){var e;let t=a.winner===d,l=null===(e=a.players.find(e=>e.id===a.winner))||void 0===e?void 0:e.username;if(t){p.Am.success("\uD83C\uDF89 승리했습니다! \uD83C\uDF89",{duration:5e3});let e=new Audio("/sounds/win.mp3");e.volume=.5,e.play().catch(e=>console.log("효과음 재생 실패:",e))}else{p.Am.error("".concat(l,"님이 승리했습니다"),{duration:5e3});let e=new Audio("/sounds/lose.mp3");e.volume=.3,e.play().catch(e=>console.log("효과음 재생 실패:",e))}}},[T,null==a?void 0:a.winner,d,null==a?void 0:a.players]),(0,s.useEffect)(()=>{if(F){(0,p.Am)("⚠️ 특수 패로 인한 재경기를 진행합니다",{duration:5e3,style:{border:"1px solid #F97316",padding:"16px",color:"#F97316"},iconTheme:{primary:"#F97316",secondary:"#FFFAEE"}});let e=new Audio("/sounds/regame.mp3");e.volume=.4,e.play().catch(e=>console.log("효과음 재생 실패:",e))}},[F]),d&&!a)?(0,l.jsx)(I,{}):d&&a?(0,l.jsxs)("div",{className:"min-h-screen w-full bg-gray-950 relative overflow-hidden",children:[(0,l.jsx)("div",{className:"absolute inset-0 overflow-hidden",style:{background:"linear-gradient(to bottom, #1a2035, #0a0a1a)",backgroundImage:"url(/images/table/bgM.png)",backgroundSize:"cover",backgroundPosition:"center",filter:"blur(8px)",opacity:.3,transform:"scale(1.1)"}}),(0,l.jsx)("div",{className:"container mx-auto p-4 relative z-10",children:(0,l.jsxs)("div",{className:"flex flex-col md:flex-row gap-6 h-[calc(100vh-2rem)]",children:[(0,l.jsxs)("div",{className:"flex-grow rounded-xl overflow-hidden shadow-2xl bg-gray-900 bg-opacity-50 border border-gray-800 relative",children:[(0,l.jsx)(y,{gameState:a,currentPlayerId:d,gameId:t,fetchGameState:z}),"playing"===a.status&&(0,l.jsx)("div",{className:"absolute bottom-4 right-4 md:bottom-6 md:right-6 w-full max-w-xs md:max-w-sm z-20",children:(0,l.jsx)(N,{gameState:a,currentPlayerId:d,onAction:D})})]}),(0,l.jsxs)("div",{className:"w-full md:w-80 lg:w-96 flex flex-col space-y-4",children:["playing"!==a.status&&(0,l.jsx)("div",{className:"h-auto",children:(0,l.jsx)(N,{gameState:a,currentPlayerId:d,onAction:D})}),(0,l.jsx)("div",{className:"flex-grow h-auto overflow-hidden",children:(0,l.jsx)(k,{gameId:t,playerId:d,username:c,messages:b})})]})]})})]}):(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-950",children:(0,l.jsxs)("div",{className:"w-full max-w-md p-8 bg-gray-900 rounded-lg shadow-lg border border-yellow-800",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-center text-yellow-400 mb-6",children:"섯다 게임 참가"}),g&&(0,l.jsx)("div",{className:"bg-red-600 text-white p-3 rounded-md mb-4",children:g}),(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),A(c)},children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{htmlFor:"username",className:"block text-sm font-bold text-gray-300 mb-2",children:"닉네임"}),(0,l.jsx)("input",{type:"text",id:"username",value:c,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 bg-gray-800 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"게임에서 사용할 닉네임을 입력하세요",disabled:u,required:!0})]}),(0,l.jsx)("button",{type:"submit",disabled:u||!c.trim(),className:"w-full py-3 bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-500 hover:to-yellow-600 text-white font-bold rounded-md shadow-lg transition-all ".concat(u||!c.trim()?"opacity-50 cursor-not-allowed":""),children:u?"참가 중...":"게임 참가하기"})]})]})})}}},function(e){e.O(0,[280,491,381,971,117,744],function(){return e(e.s=2183)}),_N_E=e.O()}]);