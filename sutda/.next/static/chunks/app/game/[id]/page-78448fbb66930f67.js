(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[184],{2183:function(e,r,t){Promise.resolve().then(t.bind(t,7573))},7573:function(e,r,t){"use strict";t.d(r,{default:function(){return b}});var a=t(7437),s=t(2265),n=t(9376),l=t(4381),i=t(5526);function c(e,r){return i.O.channel("messages:".concat(e)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"game_id=eq.".concat(e)},e=>{console.log("새 메시지 수신"),r(e)}).subscribe()}var d=t(3145),o=t(7024),u=t(2556);function m(e){let{card:r,isHidden:t=!1}=e,s=(0,o.g9)(r),n=(0,o.gr)(r);return t?(0,a.jsx)("div",{className:"w-20 h-32 rounded-md bg-red-800 border-2 border-yellow-500 flex items-center justify-center shadow-lg overflow-hidden relative",children:(0,a.jsxs)("div",{className:"w-full h-full relative",children:[(0,a.jsx)(d.default,{src:u.cardBackImagePath,alt:"카드 뒷면",width:80,height:128,layout:"responsive",className:"object-cover",onError:e=>{e.currentTarget.style.display="none"}}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-yellow-500 font-bold text-xl",children:"?"})]})}):(0,a.jsx)("div",{className:"w-20 h-32 rounded-md bg-white border-2 border-gray-300 flex flex-col items-center justify-center shadow-lg overflow-hidden relative",children:(0,a.jsxs)("div",{className:"w-full h-full relative",children:[(0,a.jsx)(d.default,{src:(0,u.getCardImagePath)(r),alt:"".concat(s,"월 ").concat(n?"광":"일반"),width:80,height:128,layout:"responsive",className:"object-cover",onError:e=>{e.currentTarget.style.display="none"}}),(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white bg-opacity-80",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-red-800",children:s}),(0,a.jsx)("div",{className:"mt-2 text-xs text-gray-800",children:n?"광":"월"})]})]})})}function g(e){let{cards:r,isHidden:n=!1}=e;return(0,s.useEffect)(()=>{Promise.resolve().then(t.bind(t,2556)).then(e=>{e.preloadCardImages()})},[]),(0,a.jsx)("div",{className:"flex space-x-2",children:r.map((e,r)=>(0,a.jsx)(m,{card:e,isHidden:n},r))})}function f(e){let{player:r,isCurrentPlayer:t,isCurrentTurn:s,showCards:n}=e,{username:l,cards:i,isDie:c,balance:d}=r;return i&&0!==i.length?c?(0,a.jsx)("div",{className:"rounded-lg p-4 bg-gray-800 opacity-60 ".concat(s?"ring-2 ring-yellow-400":""),children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"text-lg font-bold mb-2",children:l}),(0,a.jsx)("div",{className:"text-red-500 font-bold mb-2",children:"다이"}),(0,a.jsx)(g,{cards:i,isHidden:!0}),(0,a.jsxs)("div",{className:"mt-2 text-yellow-400",children:[d," 포인트"]})]})}):(0,a.jsx)("div",{className:"rounded-lg p-4 ".concat(t?"bg-blue-800":"bg-gray-700"," ").concat(s?"ring-2 ring-yellow-400":""),children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"text-lg font-bold mb-2",children:l}),(0,a.jsx)(g,{cards:i,isHidden:!t&&!n}),(0,a.jsxs)("div",{className:"mt-2 text-yellow-400",children:[d," 포인트"]})]})}):(0,a.jsx)("div",{className:"rounded-lg p-4 ".concat(t?"bg-blue-800":"bg-gray-700"," ").concat(s?"ring-2 ring-yellow-400":""),children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"text-lg font-bold mb-2",children:l}),(0,a.jsx)("div",{className:"text-sm text-gray-300",children:"대기 중..."}),(0,a.jsxs)("div",{className:"mt-2 text-yellow-400",children:[d," 포인트"]})]})})}function h(e){let{gameId:r,userId:t,username:n}=e,[d,o]=(0,s.useState)(""),[u,m]=(0,s.useState)([]),[g,f]=(0,s.useState)(!0),h=(0,s.useRef)(null),x=(0,s.useRef)(null);(0,s.useEffect)(()=>((async()=>{f(!0);try{let{data:e,error:t}=await i.O.from("messages").select("*").eq("game_id",r).order("created_at",{ascending:!0});!t&&e?m(e):console.error("메시지 불러오기 오류:",t)}catch(e){console.error("메시지 불러오기 예외:",e)}finally{f(!1)}})(),x.current=c(r,e=>{m(r=>[...r,e.new])}),()=>{if(x.current){var e;e=x.current,i.O.removeChannel(e)}}),[r]),(0,s.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[u]);let b=async e=>{if(e.preventDefault(),d.trim())try{await (0,l.bG)(r,t,n,d),o("")}catch(e){console.error("메시지 전송 오류:",e)}};return(0,a.jsxs)("div",{className:"h-full flex flex-col bg-gray-800 rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"p-2 bg-gray-700 border-b border-gray-600",children:(0,a.jsx)("h3",{className:"text-white font-bold",children:"게임 채팅"})}),(0,a.jsx)("div",{className:"flex-1 p-3 overflow-y-auto",children:g?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("p",{className:"text-gray-400",children:"메시지를 불러오는 중..."})}):(0,a.jsxs)("div",{className:"space-y-2",children:[0===u.length?(0,a.jsx)("p",{className:"text-center text-gray-400 py-4",children:"아직 메시지가 없습니다."}):u.map(e=>(0,a.jsxs)("div",{className:"p-2 rounded-lg max-w-[90%] ".concat(e.username===n?"bg-blue-600 ml-auto":"bg-gray-700"),children:[(0,a.jsx)("div",{className:"text-xs text-gray-300 mb-1",children:e.username}),(0,a.jsx)("div",{className:"text-sm",children:e.content})]},e.id)),(0,a.jsx)("div",{ref:h})]})}),(0,a.jsxs)("form",{onSubmit:b,className:"p-2 border-t border-gray-600 flex",children:[(0,a.jsx)("input",{type:"text",value:d,onChange:e=>o(e.target.value),placeholder:"메시지 입력...",className:"flex-1 px-3 py-2 bg-gray-700 rounded-l-md border border-gray-600 focus:outline-none focus:ring-1 focus:ring-blue-500"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-r-md",children:"전송"})]})]})}function x(e){var r;let{gameState:t,currentPlayerId:n,onAction:i}=e,[c,d]=(0,s.useState)(500),[o,u]=(0,s.useState)(!1),[m,g]=(0,s.useState)(null),f=t.currentTurn===n,h="waiting"===t.status,x="playing"===t.status,b="finished"===t.status,p=t.players.find(e=>e.id===n),y=t.winner?null===(r=t.players.find(e=>e.id===t.winner))||void 0===r?void 0:r.username:null,v=async()=>{u(!0),g(null);try{await (0,l.t)(t.id),i()}catch(e){console.error("게임 시작 오류:",e),g("게임을 시작하는 중 오류가 발생했습니다.")}finally{u(!1)}},w=async()=>{u(!0),g(null);try{if(!p||c<=0||c>p.balance)throw Error("유효하지 않은 베팅 금액입니다.");await (0,l.u1)(t.id,n,c),i()}catch(e){console.error("베팅 오류:",e),g("베팅 중 오류가 발생했습니다.")}finally{u(!1)}},_=async()=>{u(!0),g(null);try{await (0,l.Cb)(t.id,n),i()}catch(e){console.error("콜 오류:",e),g("콜 중 오류가 발생했습니다.")}finally{u(!1)}},j=async()=>{u(!0),g(null);try{await (0,l.Op)(t.id,n),i()}catch(e){console.error("다이 오류:",e),g("다이 중 오류가 발생했습니다.")}finally{u(!1)}};return b?(0,a.jsxs)("div",{className:"p-6 bg-gray-700 rounded-lg",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-center mb-4",children:"게임 종료"}),y&&(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("p",{className:"text-yellow-400 font-bold mb-2",children:[y,"님이 승리했습니다!"]}),(0,a.jsxs)("p",{className:"text-gray-300",children:["획득 포인트: ",t.bettingValue]})]}),(0,a.jsx)("button",{className:"mt-4 w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-md",onClick:()=>window.location.href="/",children:"홈으로 돌아가기"})]}):h?(0,a.jsxs)("div",{className:"p-6 bg-gray-700 rounded-lg",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-center mb-4",children:"게임 대기 중"}),(0,a.jsxs)("p",{className:"text-gray-300 text-center mb-4",children:["현재 ",t.players.length,"명의 플레이어가 대기 중입니다."]}),m&&(0,a.jsx)("div",{className:"bg-red-500 text-white p-3 rounded-md mb-4",children:m}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{className:"py-3 px-6 bg-green-600 hover:bg-green-700 text-white font-bold rounded-md ".concat(o?"opacity-50 cursor-not-allowed":""),onClick:v,disabled:o||t.players.length<2,children:o?"처리 중...":"게임 시작"})}),t.players.length<2&&(0,a.jsx)("p",{className:"text-red-400 text-center mt-2",children:"최소 2명의 플레이어가 필요합니다."}),(0,a.jsxs)("div",{className:"mt-4 text-gray-300 text-center text-sm",children:[(0,a.jsxs)("p",{children:["게임 ID: ",t.id]}),(0,a.jsx)("p",{className:"mt-1",children:"이 ID를 친구들에게 공유하여 같이 게임하세요!"})]})]}):x?(0,a.jsxs)("div",{className:"p-6 bg-gray-700 rounded-lg",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-center mb-4",children:"게임 진행 중"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("p",{className:"text-gray-300",children:["현재 베팅 금액: ",(0,a.jsxs)("span",{className:"text-yellow-400 font-bold",children:[t.bettingValue," 포인트"]})]}),p&&(0,a.jsxs)("p",{className:"text-gray-300 mt-1",children:["내 잔액: ",(0,a.jsxs)("span",{className:"text-yellow-400 font-bold",children:[p.balance," 포인트"]})]})]}),m&&(0,a.jsx)("div",{className:"bg-red-500 text-white p-3 rounded-md mb-4",children:m}),f?(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-green-400 font-bold mb-3",children:"당신의 차례입니다!"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-300 mb-1",children:"베팅 금액"}),(0,a.jsx)("input",{type:"number",value:c,onChange:e=>d(parseInt(e.target.value)||0),min:100,max:(null==p?void 0:p.balance)||0,step:100,className:"w-full px-3 py-2 bg-gray-800 rounded-md border border-gray-600 focus:outline-none focus:ring-1 focus:ring-blue-500",disabled:o})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,a.jsx)("button",{className:"py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-md ".concat(o?"opacity-50 cursor-not-allowed":""),onClick:w,disabled:o||!p||c<=0||c>p.balance,children:"베팅"}),(0,a.jsx)("button",{className:"py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded-md ".concat(o?"opacity-50 cursor-not-allowed":""),onClick:_,disabled:o,children:"콜"}),(0,a.jsx)("button",{className:"py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-md ".concat(o?"opacity-50 cursor-not-allowed":""),onClick:j,disabled:o,children:"다이"})]})]})]}):(0,a.jsx)("p",{className:"text-center text-gray-300",children:"다른 플레이어의 차례입니다."})]}):(0,a.jsx)("div",{className:"p-6 bg-gray-700 rounded-lg",children:(0,a.jsx)("p",{className:"text-center text-gray-300",children:"게임 상태를 불러오는 중..."})})}function b(e){let{gameId:r}=e,t=(0,n.useSearchParams)(),d=t.get("userId")||"",u=t.get("username")||"",[m,b]=(0,s.useState)(null),[p,y]=(0,s.useState)(!0),[v,w]=(0,s.useState)(null),[_,j]=(0,s.useState)(!1),[N,O]=(0,s.useState)(null),[q,k]=(0,s.useState)(null),E=(0,s.useCallback)(async()=>{try{let e=await (0,l.ky)(r);b(e),w(null),"finished"===e.status&&j(!0)}catch(e){console.error("게임 상태 불러오기 오류:",e),w("게임 정보를 불러올 수 없습니다.")}finally{y(!1)}},[r]),I=(0,s.useCallback)(e=>{console.log("새 메시지 수신됨",e)},[]);(0,s.useEffect)(()=>{E();let e=i.O.channel("game:".concat(r)).on("postgres_changes",{event:"*",schema:"public",table:"games",filter:"id=eq.".concat(r)},()=>{console.log("게임 상태 변경 감지"),null==E||E()}).on("postgres_changes",{event:"*",schema:"public",table:"players",filter:"game_id=eq.".concat(r)},()=>{console.log("플레이어 정보 변경 감지"),null==E||E()}).on("postgres_changes",{event:"*",schema:"public",table:"game_actions",filter:"game_id=eq.".concat(r)},()=>{console.log("게임 액션 변경 감지"),null==E||E()}).subscribe(e=>{console.log("Supabase 실시간 연결 상태: ".concat(e))}),t=c(r,I);return O(e),k(t),()=>{e&&i.O.removeChannel(e),t&&i.O.removeChannel(t)}},[r,E,I]);let C=null==m?void 0:m.players.find(e=>e.id===d),S=null;return((null==C?void 0:C.cards)&&2===C.cards.length&&(S=(0,o.z0)(C.cards)),p)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-800 text-white",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("p",{className:"text-xl",children:"게임을 불러오는 중..."})})}):v||!m?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-800 text-white",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-xl text-red-500 mb-4",children:v||"게임을 찾을 수 없습니다."}),(0,a.jsx)("button",{onClick:()=>window.location.href="/",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:"홈으로 돌아가기"})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-800 text-white p-4",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6 text-center",children:"한국식 포커 - 섯다"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"md:col-span-3 space-y-4",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:m.players.map(e=>(0,a.jsx)(f,{player:e,isCurrentPlayer:e.id===d,isCurrentTurn:e.id===m.currentTurn,showCards:_},e.id))}),S&&(0,a.jsxs)("div",{className:"p-4 bg-gray-700 rounded-lg",children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-2",children:"내 카드 조합"}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(g,{cards:S.cards}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"font-bold text-yellow-400",children:S.rank}),(0,a.jsxs)("p",{className:"text-sm text-gray-300",children:["점수: ",S.value]})]})]})]}),(0,a.jsx)(x,{gameState:m,currentPlayerId:d,onAction:E})]}),(0,a.jsx)("div",{className:"h-[600px]",children:(0,a.jsx)(h,{gameId:r,userId:d,username:u})})]})]})})}},4381:function(e,r,t){"use strict";t.d(r,{Cb:function(){return d},Op:function(){return o},bG:function(){return m},dz:function(){return n},ky:function(){return u},nY:function(){return l},t:function(){return i},u1:function(){return c}});var a=t(5526),s=t(7024);async function n(){let{data:e,error:r}=await a.O.from("games").insert({status:"waiting",betting_value:0,current_turn:null}).select("id").single();if(r)throw console.error("게임 생성 오류:",r),r;return e.id}async function l(e,r,t){let{data:s}=await a.O.from("players").select("id").eq("game_id",e).eq("user_id",r).single();if(s){console.log("이미 게임에 참가 중입니다.");return}let{error:n}=await a.O.from("players").insert({game_id:e,user_id:r,username:t,cards:[],is_die:!1,balance:1e4});if(n)throw console.error("게임 참가 오류:",n),n;await a.O.from("game_actions").insert({game_id:e,player_id:r,action_type:"join",amount:0})}async function i(e){let{data:r,error:t}=await a.O.from("players").select("id, user_id").eq("game_id",e);if(t||!r||r.length<2)throw console.error("게임 시작 오류: 참가자가 부족합니다."),Error("게임을 시작하려면 최소 2명의 플레이어가 필요합니다.");let n=(0,s._7)();for(let e of r.map((e,r)=>{let t=[n[2*r],n[2*r+1]];return{id:e.id,cards:t}}))await a.O.from("players").update({cards:e.cards}).eq("id",e.id);await a.O.from("games").update({status:"playing",current_turn:r[0].user_id,betting_value:0}).eq("id",e)}async function c(e,r,t){let{data:n,error:l}=await a.O.from("games").select("current_turn, betting_value").eq("id",e).single();if(l||!n)throw console.error("베팅 오류: 게임을 찾을 수 없습니다."),Error("게임을 찾을 수 없습니다.");if(n.current_turn!==r)throw Error("당신의 차례가 아닙니다.");let{data:i,error:c}=await a.O.from("players").select("balance, is_die").eq("game_id",e).eq("user_id",r).single();if(c||!i)throw console.error("베팅 오류: 플레이어를 찾을 수 없습니다."),Error("플레이어를 찾을 수 없습니다.");if(i.is_die)throw Error("이미 다이 상태입니다.");if(i.balance<t)throw Error("잔액이 부족합니다.");await a.O.from("players").update({balance:i.balance-t}).eq("game_id",e).eq("user_id",r),await a.O.from("game_actions").insert({game_id:e,player_id:r,action_type:"bet",amount:t});let d=n.betting_value+t,{data:o,error:u}=await a.O.from("players").select("user_id, is_die").eq("game_id",e);if(u||!o)throw console.error("베팅 오류: 플레이어 목록을 가져올 수 없습니다."),Error("플레이어 목록을 가져올 수 없습니다.");let m=(0,s.el)(r,o.map(e=>({id:e.user_id,isDie:e.is_die})));await a.O.from("games").update({betting_value:d,current_turn:m}).eq("id",e)}async function d(e,r){let{data:t,error:n}=await a.O.from("games").select("current_turn, betting_value").eq("id",e).single();if(n||!t)throw console.error("콜 오류: 게임을 찾을 수 없습니다."),Error("게임을 찾을 수 없습니다.");if(t.current_turn!==r)throw Error("당신의 차례가 아닙니다.");let{data:l,error:i}=await a.O.from("game_actions").select("amount").eq("game_id",e).eq("action_type","bet").order("created_at",{ascending:!1}).limit(1).single();if(i||!l)throw console.error("콜 오류: 마지막 베팅 정보를 찾을 수 없습니다."),Error("마지막 베팅 정보를 찾을 수 없습니다.");let c=l.amount,{data:d,error:o}=await a.O.from("players").select("balance, is_die").eq("game_id",e).eq("user_id",r).single();if(o||!d)throw console.error("콜 오류: 플레이어를 찾을 수 없습니다."),Error("플레이어를 찾을 수 없습니다.");if(d.is_die)throw Error("이미 다이 상태입니다.");if(d.balance<c)throw Error("잔액이 부족합니다.");await a.O.from("players").update({balance:d.balance-c}).eq("game_id",e).eq("user_id",r),await a.O.from("game_actions").insert({game_id:e,player_id:r,action_type:"call",amount:c});let u=t.betting_value+c,{data:m,error:g}=await a.O.from("players").select("user_id, is_die, cards").eq("game_id",e);if(g||!m)throw console.error("콜 오류: 플레이어 목록을 가져올 수 없습니다."),Error("플레이어 목록을 가져올 수 없습니다.");let{data:f,error:h}=await a.O.from("game_actions").select("player_id").eq("game_id",e).eq("action_type","call").order("created_at",{ascending:!1});if(h)throw console.error("콜 오류: 콜 횟수를 확인할 수 없습니다."),Error("콜 횟수를 확인할 수 없습니다.");let x=m.filter(e=>!e.is_die);if(f&&f.length>=x.length-1){let r=(0,s.M2)(m.map(e=>({id:e.user_id,cards:e.cards,isDie:e.is_die})));if(r){let{data:t,error:s}=await a.O.from("players").select("balance").eq("game_id",e).eq("user_id",r).single();!s&&t&&await a.O.from("players").update({balance:t.balance+u}).eq("game_id",e).eq("user_id",r),await a.O.from("games").update({status:"finished",winner:r,betting_value:0}).eq("id",e)}}else{let t=(0,s.el)(r,m.map(e=>({id:e.user_id,isDie:e.is_die})));await a.O.from("games").update({betting_value:u,current_turn:t}).eq("id",e)}}async function o(e,r){let{data:t,error:n}=await a.O.from("games").select("current_turn, status").eq("id",e).single();if(n||!t)throw console.error("다이 오류: 게임을 찾을 수 없습니다."),Error("게임을 찾을 수 없습니다.");if(t.current_turn!==r)throw Error("당신의 차례가 아닙니다.");if("playing"!==t.status)throw Error("게임이 진행 중이 아닙니다.");await a.O.from("players").update({is_die:!0}).eq("game_id",e).eq("user_id",r),await a.O.from("game_actions").insert({game_id:e,player_id:r,action_type:"die",amount:0});let{data:l,error:i}=await a.O.from("players").select("user_id, is_die, cards").eq("game_id",e);if(i||!l)throw console.error("다이 오류: 플레이어 목록을 가져올 수 없습니다."),Error("플레이어 목록을 가져올 수 없습니다.");let c=l.filter(e=>!e.is_die);if(1===c.length){let r=c[0].user_id,{data:t,error:s}=await a.O.from("players").select("balance").eq("game_id",e).eq("user_id",r).single();if(!s&&t){let{data:s,error:n}=await a.O.from("games").select("betting_value").eq("id",e).single();!n&&s&&(await a.O.from("players").update({balance:t.balance+s.betting_value}).eq("game_id",e).eq("user_id",r),await a.O.from("games").update({status:"finished",winner:r,betting_value:0}).eq("id",e))}}else{let t=(0,s.el)(r,l.map(e=>({id:e.user_id,isDie:e.is_die})));await a.O.from("games").update({current_turn:t}).eq("id",e)}}async function u(e){let{data:r,error:t}=await a.O.from("games").select("*").eq("id",e).single();if(t||!r)throw console.error("게임 상태 조회 오류:",t),Error("게임을 찾을 수 없습니다.");let{data:s,error:n}=await a.O.from("players").select("*").eq("game_id",e);if(n)throw console.error("플레이어 정보 조회 오류:",n),Error("플레이어 정보를 가져올 수 없습니다.");return{id:r.id,status:r.status,currentTurn:r.current_turn,bettingValue:r.betting_value,winner:r.winner,players:s.map(e=>({id:e.user_id,username:e.username,cards:e.cards,isDie:e.is_die,balance:e.balance}))}}async function m(e,r,t,s){let{error:n}=await a.O.from("messages").insert({game_id:e,user_id:r,username:t,content:s});if(n)throw console.error("메시지 전송 오류:",n),n}},5526:function(e,r,t){"use strict";t.d(r,{O:function(){return a}});let a=(0,t(3777).eI)("https://ftzxcbarjntphlwmincc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ0enhjYmFyam50cGhsd21pbmNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIzNzk5OTAsImV4cCI6MjA1Nzk1NTk5MH0.h8y5X3kCGJgvVf-_EA4jOyjU-4Z5q24GHklQZgrocY4")},2556:function(e,r,t){"use strict";t.r(r),t.d(r,{cardBackImagePath:function(){return s},getCardImagePath:function(){return n},preloadCardImages:function(){return l}});let a={1:"/images/cards/1-1.png",2:"/images/cards/1-2.png",3:"/images/cards/2-1.png",4:"/images/cards/2-2.png",5:"/images/cards/3-1.png",6:"/images/cards/3-2.png",7:"/images/cards/4-1.png",8:"/images/cards/4-2.png",9:"/images/cards/5-1.png",10:"/images/cards/5-2.png",11:"/images/cards/6-1.png",12:"/images/cards/6-2.png",13:"/images/cards/7-1.png",14:"/images/cards/7-2.png",15:"/images/cards/8-1.png",16:"/images/cards/8-2.png",17:"/images/cards/9-1.png",18:"/images/cards/9-2.png",19:"/images/cards/10-1.png",20:"/images/cards/10-2.png"},s="/images/cards/back.png";function n(e){return e<1||e>20?(console.warn("유효하지 않은 카드 번호: ".concat(e)),s):a[e]}function l(){console.log("카드 이미지 사전 로드 중..."),Object.values(a).forEach(e=>{new Image().src=e}),new Image().src=s,console.log("카드 이미지 사전 로드 완료")}},7024:function(e,r,t){"use strict";t.d(r,{M2:function(){return d},_7:function(){return l},el:function(){return c},g9:function(){return s},gr:function(){return n},z0:function(){return i}});let a=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20];function s(e){return Math.ceil(e/2)}function n(e){return 1===e||3===e||8===e}function l(){let e=[...a];for(let r=e.length-1;r>0;r--){let t=Math.floor(Math.random()*(r+1));[e[r],e[t]]=[e[t],e[r]]}return e}function i(e){if(2!==e.length)throw Error("카드는 정확히 2장이어야 합니다");let[r,t]=e,a=s(r),n=s(t);if(1===r&&3===t)return{cards:e,rank:"광땡",value:1e3};if(1===r&&8===t)return{cards:e,rank:"광땡",value:999};if(1===t&&3===r)return{cards:e,rank:"광땡",value:1e3};if(1===t&&8===r)return{cards:e,rank:"광땡",value:999};if(a===n)return{cards:e,rank:"땡",value:900+10*a};if(1===a&&2===n||2===a&&1===n)return{cards:e,rank:"알리",value:800};if(1===a&&4===n||4===a&&1===n)return{cards:e,rank:"독사",value:700};if(1===a&&9===n||9===a&&1===n)return{cards:e,rank:"구삥",value:600};if(1===a&&10===n||10===a&&1===n)return{cards:e,rank:"장삥",value:500};if(4===a&&10===n||10===a&&4===n)return{cards:e,rank:"장사",value:400};if(4===a&&6===n||6===a&&4===n)return{cards:e,rank:"세륙",value:300};let l=(a+n)%10;return 0===l?{cards:e,rank:"망통",value:0}:{cards:e,rank:"끗",value:l}}function c(e,r){let t=r.filter(e=>!e.isDie);if(t.length<=1){var a;return(null===(a=t[0])||void 0===a?void 0:a.id)||e}let s=(t.findIndex(r=>r.id===e)+1)%t.length;return t[s].id}function d(e){let r=e.filter(e=>!e.isDie);if(0===r.length)return null;if(1===r.length)return r[0].id;let t=r[0].id,a=r[0].cards;for(let e=1;e<r.length;e++)2===function(e,r){let t=i(e),a=i(r);return t.value>a.value?1:t.value<a.value?2:0}(a,r[e].cards)&&(t=r[e].id,a=r[e].cards);return t}}},function(e){e.O(0,[675,145,971,117,744],function(){return e(e.s=2183)}),_N_E=e.O()}]);